<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fenwick Tree Visualizer ‚Äì BIT Interactive</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }
        body {
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(145deg, #0f172a 0%, #1e293b 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            width: 100%;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 48px;
            padding: 30px;
            box-shadow: 0 30px 60px -20px #000000, 0 0 0 1px rgba(56, 189, 248, 0.2);
            border: 1px solid #334155;
        }
        h1 {
            margin: 0 0 8px 0;
            font-weight: 600;
            font-size: 2.5rem;
            letter-spacing: -0.02em;
            background: linear-gradient(120deg, #bae6fd, #7dd3fc, #38bdf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        h1 span {
            background: #0f293f;
            font-size: 1rem;
            padding: 6px 18px;
            border-radius: 40px;
            color: #7dd3fc;
            border: 1px solid #226688;
            font-weight: 400;
            -webkit-text-fill-color: #b0e0ff;
        }
        .subtitle {
            color: #94a3b8;
            margin-bottom: 32px;
            font-size: 1.1rem;
            border-left: 4px solid #0284c7;
            padding-left: 20px;
            background: #1e2a3a40;
            border-radius: 0 20px 20px 0;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: 1.6fr 1fr;
            gap: 28px;
        }
        /* left panel: tree visualization */
        .tree-panel {
            background: #0f1825;
            border-radius: 32px;
            padding: 28px 20px;
            border: 1px solid #2a4055;
            box-shadow: inset 0 2px 5px #00000055, 0 10px 20px -5px #030712;
        }
        .tree-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .tree-header h2 {
            color: #e2e8f0;
            font-weight: 500;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend {
            display: flex;
            gap: 22px;
            color: #aac8e0;
            font-size: 0.9rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-dot {
            width: 16px;
            height: 16px;
            border-radius: 6px;
            background: #1e4976;
        }
        .legend-dot.index {
            background: #2b6ca3;
            border: 2px solid #64b5f6;
        }
        .legend-dot.value {
            background: #117a65;
            border: 2px solid #2ecc71;
        }
        .canvas-wrapper {
            background: #0b121f;
            border-radius: 32px;
            padding: 25px 15px 15px 15px;
            border: 1px solid #29455e;
            overflow-x: auto;
            overflow-y: visible;
            min-height: 300px;
        }
        .tree-svg {
            display: block;
            margin: 0 auto;
            background: #0b121f;
            border-radius: 24px;
            width: 100%;
            height: auto;
            min-width: 600px;
        }
        .tree-svg text {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-weight: 500;
        }
        /* right panel: controls */
        .controls-panel {
            background: #0f1a29;
            border-radius: 32px;
            padding: 28px 24px;
            border: 1px solid #2e4b66;
            display: flex;
            flex-direction: column;
            gap: 28px;
        }
        .array-card {
            background: #112131;
            border-radius: 26px;
            padding: 22px 20px;
            border: 1px solid #31556f;
        }
        .array-card h3 {
            color: #b0d4f0;
            margin-top: 0;
            margin-bottom: 22px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .array-cells {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            justify-content: center;
        }
        .array-cell {
            background: #1c2f44;
            width: 70px;
            height: 70px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #315577;
            box-shadow: 0 6px 0 #0a121e;
            transition: 0.2s;
        }
        .array-cell .idx {
            font-size: 0.85rem;
            color: #90b8dc;
            background: #1f3a52;
            padding: 2px 10px;
            border-radius: 30px;
            margin-bottom: 6px;
            border: 1px solid #3a6685;
        }
        .array-cell .val {
            font-size: 1.5rem;
            font-weight: 700;
            color: #dcf2ff;
            font-family: monospace;
        }
        .update-group {
            background: #11293b;
            border-radius: 24px;
            padding: 22px;
            border: 1px solid #2d5b79;
        }
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .input-row label {
            color: #b3d9f0;
            min-width: 50px;
        }
        .input-row input {
            background: #1c3348;
            border: 2px solid #2c577a;
            border-radius: 40px;
            padding: 14px 20px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            width: 120px;
            outline: none;
            transition: 0.2s;
            font-family: monospace;
            text-align: center;
        }
        .input-row input:focus {
            border-color: #38bdf8;
            box-shadow: 0 0 15px #38bdf880;
        }
        .btn-group {
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
            margin: 25px 0 15px;
        }
        .btn {
            background: #1d3d5a;
            border: none;
            border-radius: 60px;
            padding: 14px 28px;
            font-weight: 600;
            color: #e1f2ff;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.15s;
            border: 1px solid #3980aa;
            flex: 1 0 auto;
            box-shadow: 0 5px 0 #0c1925;
        }
        .btn-primary {
            background: #0d5b7a;
            border-color: #4ab0e0;
            color: white;
            box-shadow: 0 5px 0 #073244;
        }
        .btn-primary:hover {
            background: #1378a2;
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #073244;
        }
        .btn-secondary:hover {
            background: #265177;
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #0c1f30;
        }
        .query-result {
            background: #082032;
            border-radius: 30px;
            padding: 22px;
            border: 1px solid #3c789b;
            margin-top: 20px;
        }
        .query-result h4 {
            margin: 0 0 15px 0;
            color: #b3defa;
            font-weight: 400;
        }
        .result-badge {
            background: #193c51;
            padding: 16px 22px;
            border-radius: 50px;
            font-size: 2rem;
            font-weight: 700;
            font-family: monospace;
            color: #b3f0ff;
            display: inline-block;
            border: 2px solid #3590c4;
            box-shadow: 0 0 20px #0055aa80;
        }
        .footer-note {
            color: #4d6888;
            margin-top: 25px;
            text-align: center;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üå≥ Fenwick Tree Visualizer <span>Binary Indexed Tree</span></h1>
    <div class="subtitle">point update ¬∑ prefix sum ¬∑ interactive simulation</div>

    <div class="grid-2">
        <!-- LEFT: Tree diagram -->
        <div class="tree-panel">
            <div class="tree-header">
                <h2>üìå BIT structure (1‚Äëbased)</h2>
                <div class="legend">
                    <div class="legend-item"><span class="legend-dot index"></span> tree index</div>
                    <div class="legend-item"><span class="legend-dot value"></span> stored sum</div>
                </div>
            </div>
            <div class="canvas-wrapper">
                <svg id="treeSvg" class="tree-svg" viewBox="0 0 750 350" preserveAspectRatio="xMidYMid meet"></svg>
            </div>
        </div>

        <!-- RIGHT: Controls and array -->
        <div class="controls-panel">
            <!-- current array view -->
            <div class="array-card">
                <h3>üìã original array A[1..8]</h3>
                <div id="arrayContainer" class="array-cells">
                    <!-- dynamic js filled -->
                </div>
            </div>

            <!-- point update -->
            <div class="update-group">
                <h3 style="color:#b4dcff; margin:0 0 20px 0;">‚úèÔ∏è point update</h3>
                <div class="input-row">
                    <label>index i</label>
                    <input type="number" id="updateIdx" min="1" max="8" value="3" step="1">
                </div>
                <div class="input-row">
                    <label>delta +</label>
                    <input type="number" id="updateDelta" value="2" step="1">
                </div>
                <button class="btn btn-primary" id="applyUpdate">apply update</button>
            </div>

            <!-- prefix query -->
            <div class="update-group">
                <h3 style="color:#b4dcff; margin:0 0 20px 0;">üîé prefix sum query</h3>
                <div class="input-row">
                    <label>prefix r</label>
                    <input type="number" id="queryIdx" min="0" max="8" value="5" step="1">
                </div>
                <button class="btn btn-secondary" id="runQuery">compute sum(1..r)</button>
                <div class="query-result">
                    <h4>result ‚û§</h4>
                    <span class="result-badge" id="queryResult">0</span>
                </div>
            </div>

            <!-- reset -->
            <button class="btn" id="resetBtn">‚ü≤ reset to initial values</button>
            <div class="footer-note">‚ö° BIT is updated in real time ¬∑ each node stores sum of range</div>
        </div>
    </div>
</div>

<script>
    (function() {
        // ---------- Fenwick tree state (1‚Äëbased, size 8) ----------
        const SIZE = 8;
        // original array values (1‚Äëbased, index 1..8)
        let A = [0, 3, 2, 7, 1, 8, 4, 5, 6]; // A[1]=3, A[2]=2, A[3]=7, A[4]=1, A[5]=8, A[6]=4, A[7]=5, A[8]=6
        
        // build BIT from A
        let BIT = new Array(SIZE + 1).fill(0);
        
        // build initially
        function buildBIT() {
            BIT.fill(0);
            for (let i = 1; i <= SIZE; i++) {
                _updateBIT(i, A[i]);
            }
        }
        
        // internal point update (delta)
        function _updateBIT(idx, delta) {
            while (idx <= SIZE) {
                BIT[idx] += delta;
                idx += idx & -idx;
            }
        }
        
        // public update
        function pointUpdate(index, delta) {
            if (index < 1 || index > SIZE) return;
            A[index] += delta;               // update original array
            _updateBIT(index, delta);        // propagate to BIT
            renderArray();
            renderTree();
        }
        
        // prefix sum 1..r
        function prefixSum(r) {
            let sum = 0;
            while (r > 0) {
                sum += BIT[r];
                r -= r & -r;
            }
            return sum;
        }
        
        // initial build
        buildBIT();

        // ---------- DOM elements ----------
        const arrayContainer = document.getElementById('arrayContainer');
        const treeSvg = document.getElementById('treeSvg');
        const updateIdx = document.getElementById('updateIdx');
        const updateDelta = document.getElementById('updateDelta');
        const applyUpdate = document.getElementById('applyUpdate');
        const queryIdx = document.getElementById('queryIdx');
        const runQuery = document.getElementById('runQuery');
        const queryResultSpan = document.getElementById('queryResult');
        const resetBtn = document.getElementById('resetBtn');

        // render array boxes
        function renderArray() {
            let html = '';
            for (let i = 1; i <= SIZE; i++) {
                html += `<div class="array-cell"><span class="idx">${i}</span><span class="val">${A[i]}</span></div>`;
            }
            arrayContainer.innerHTML = html;
        }

        // draw BIT tree with nodes (1..8)
        function renderTree() {
            // fixed positions for nodes (x, y) ‚Äì nice layout
            const coords = {
                1: { x: 70, y: 250 },
                2: { x: 170, y: 200 },
                3: { x: 270, y: 250 },
                4: { x: 370, y: 120 },
                5: { x: 470, y: 250 },
                6: { x: 570, y: 200 },
                7: { x: 670, y: 250 },
                8: { x: 200, y: 40 }   // top node
            };

            // children lines (based on BIT update chain: i -> i + lowbit)
            // we draw edges from node to its "parent" (i+lowbit) ‚Äì nicer visualization.
            // typical BIT visualization: each i is responsible to i+lowbit
            let edges = [];
            for (let i = 1; i <= SIZE; i++) {
                let parent = i + (i & -i);
                if (parent <= SIZE) {
                    edges.push({ from: i, to: parent });
                }
            }

            // start SVG content
            let svgContent = '';

            // draw edges (grey lines)
            edges.forEach(edge => {
                const from = coords[edge.from];
                const to = coords[edge.to];
                svgContent += `<line x1="${from.x}" y1="${from.y}" x2="${to.x}" y2="${to.y}" stroke="#2a4f70" stroke-width="3" stroke-dasharray="6 6" opacity="0.7" />`;
            });

            // draw nodes (circles + text)
            for (let i = 1; i <= SIZE; i++) {
                const c = coords[i];
                // main circle
                svgContent += `<circle cx="${c.x}" cy="${c.y}" r="34" fill="#102433" stroke="#2f76b5" stroke-width="3" filter="url(#glow)" />`;
                // index label
                svgContent += `<text x="${c.x}" y="${c.y - 6}" text-anchor="middle" fill="#80b5dc" font-size="14" font-weight="500">BIT[${i}]</text>`;
                // value label
                svgContent += `<text x="${c.x}" y="${c.y + 18}" text-anchor="middle" fill="#b2f0c0" font-size="20" font-weight="700" font-family="monospace">${BIT[i]}</text>`;
            }

            // filter definition for subtle glow
            svgContent += `<defs><filter id="glow" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur in="SourceAlpha" stdDeviation="4"/><feMerge><feMergeNode in="offsetblur" /><feMergeNode in="SourceGraphic" /></feMerge></filter></defs>`;

            treeSvg.innerHTML = svgContent;
        }

        // update query result display
        function updateQueryDisplay() {
            let r = parseInt(queryIdx.value, 10);
            if (isNaN(r) || r < 0) r = 0;
            if (r > SIZE) r = SIZE;
            const res = prefixSum(r);
            queryResultSpan.innerText = res;
        }

        // event: apply point update
        applyUpdate.addEventListener('click', () => {
            const idx = parseInt(updateIdx.value, 10);
            const delta = parseInt(updateDelta.value, 10);
            if (isNaN(idx) || idx < 1 || idx > SIZE) {
                alert('index must be between 1 and 8');
                return;
            }
            if (isNaN(delta)) {
                alert('delta must be a number');
                return;
            }
            pointUpdate(idx, delta);
            updateQueryDisplay();  // query result may change because prefix sum changed
        });

        // event: run query
        runQuery.addEventListener('click', () => {
            updateQueryDisplay();
        });

        // reset to initial values
        resetBtn.addEventListener('click', () => {
            // reinit A
            A = [0, 3, 2, 7, 1, 8, 4, 5, 6];
            buildBIT();
            renderArray();
            renderTree();
            updateQueryDisplay();
            // reset inputs to defaults
            updateIdx.value = 3;
            updateDelta.value = 2;
            queryIdx.value = 5;
        });

        // initial render
        renderArray();
        renderTree();
        updateQueryDisplay();

        // also update query when input changes (optional)
        queryIdx.addEventListener('input', updateQueryDisplay);

        // helper to sync after manual update
        function syncAll() {
            renderTree();
            renderArray();
        }

        // extra: if you want to see tree on update
        window.pointUpdate = pointUpdate; // debug

        // ensure everything updates on any change via pointUpdate already calls render.
        // but we also call in reset.
    })();
</script>
</body>
</html>