<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptogram Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&display=swap');
        
        body {
            background-color: #0f172a;
            color: #f8fafc;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        .mono {
            font-family: 'JetBrains+Mono', monospace;
        }

        .letter-cell {
            width: 32px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 2px;
        }

        input.user-input {
            width: 32px;
            height: 36px;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 4px;
            text-align: center;
            font-size: 1.25rem;
            color: #38bdf8;
            text-transform: uppercase;
            outline: none;
            transition: all 0.2s;
        }

        input.user-input:focus {
            border-color: #38bdf8;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.3);
        }

        input.user-input.locked {
            color: #10b981;
            border-color: #10b981;
        }

        .cipher-char {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 4px;
        }

        .word-container {
            display: flex;
            flex-wrap: wrap;
            margin-right: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .keyboard-key {
            min-width: 35px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #334155;
            border-radius: 6px;
            cursor: pointer;
            user-select: none;
            font-weight: bold;
            transition: background 0.2s;
        }

        .keyboard-key:hover {
            background: #475569;
        }

        .keyboard-key.used {
            opacity: 0.3;
            cursor: default;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <div class="max-w-4xl w-full">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-sky-400 mb-2">CRYPTOGRAM</h1>
            <p class="text-slate-400">Decipher the quote by replacing symbols with letters.</p>
            <div class="flex justify-center gap-6 mt-4 text-sm">
                <div id="timer">Time: 00:00</div>
                <div id="hint-count">Hints used: 0</div>
            </div>
        </header>

        <!-- Game Board -->
        <main id="game-board" class="flex flex-wrap justify-center p-6 bg-slate-800/50 rounded-xl shadow-2xl border border-slate-700 min-h-[200px]">
            <!-- Content generated by JS -->
        </main>

        <!-- Controls -->
        <div class="flex flex-wrap justify-center gap-4 mt-8">
            <button onclick="getHint()" class="px-6 py-2 bg-amber-600 hover:bg-amber-500 rounded-lg font-semibold transition">Get Hint</button>
            <button onclick="initGame()" class="px-6 py-2 bg-sky-600 hover:bg-sky-500 rounded-lg font-semibold transition">New Game</button>
            <button onclick="clearBoard()" class="px-6 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg font-semibold transition">Clear All</button>
        </div>

        <!-- Virtual Keyboard -->
        <div id="keyboard" class="mt-8 flex flex-wrap justify-center gap-2 max-w-2xl mx-auto">
            <!-- Content generated by JS -->
        </div>
    </div>

    <!-- Success Modal -->
    <div id="modal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-slate-800 border-2 border-emerald-500 p-8 rounded-2xl text-center max-w-md w-full shadow-2xl">
            <h2 class="text-3xl font-bold text-emerald-400 mb-4">CRACKED!</h2>
            <p id="final-stats" class="text-slate-300 mb-6"></p>
            <button onclick="closeModal()" class="w-full py-3 bg-emerald-600 hover:bg-emerald-500 rounded-xl font-bold text-lg transition">Play Again</button>
        </div>
    </div>

    <script>
        const quotes = [
            "THE ONLY LIMIT TO OUR REALIZATION OF TOMORROW IS OUR DOUBTS OF TODAY.",
            "STAY HUNGRY STAY FOOLISH.",
            "GENIUS IS ONE PERCENT INSPIRATION AND NINETY NINE PERCENT PERSPIRATION.",
            "WHATEVER YOU ARE BE A GOOD ONE.",
            "DO WHAT YOU CAN WITH WHAT YOU HAVE WHERE YOU ARE.",
            "THE BEST WAY TO PREDICT THE FUTURE IS TO CREATE IT.",
            "SUCCESS IS NOT FINAL FAILURE IS NOT FATAL IT IS THE COURAGE TO CONTINUE THAT COUNTS.",
            "DREAM BIG AND DARE TO FAIL.",
            "IT ALWAYS SEEMS IMPOSSIBLE UNTIL IT IS DONE.",
            "IN THE MIDDLE OF EVERY DIFFICULTY LIES OPPORTUNITY."
        ];

        let currentQuote = "";
        let cipherMap = {}; // Real Letter -> Cipher Letter
        let userProgress = {}; // Cipher Letter -> User Guess
        let timerInterval;
        let seconds = 0;
        let hintsUsed = 0;
        let activeInput = null;

        function generateCipher() {
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
            let shuffled = [...alphabet].sort(() => Math.random() - 0.5);
            
            // Ensure no letter maps to itself
            for(let i=0; i<26; i++) {
                if(alphabet[i] === shuffled[i]) {
                    let next = (i + 1) % 26;
                    [shuffled[i], shuffled[next]] = [shuffled[next], shuffled[i]];
                }
            }

            cipherMap = {};
            alphabet.forEach((letter, i) => {
                cipherMap[letter] = shuffled[i];
            });
        }

        function initGame() {
            // Reset state
            clearInterval(timerInterval);
            seconds = 0;
            hintsUsed = 0;
            userProgress = {};
            document.getElementById('timer').innerText = "Time: 00:00";
            document.getElementById('hint-count').innerText = "Hints used: 0";
            document.getElementById('modal').classList.add('hidden');
            
            generateCipher();
            currentQuote = quotes[Math.floor(Math.random() * quotes.length)];
            
            renderBoard();
            renderKeyboard();
            startTimer();
        }

        function renderBoard() {
            const board = document.getElementById('game-board');
            board.innerHTML = "";
            const words = currentQuote.split(" ");

            words.forEach(word => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-container';

                word.split("").forEach(char => {
                    const cell = document.createElement('div');
                    cell.className = 'letter-cell';

                    if (/[A-Z]/.test(char)) {
                        const cipher = cipherMap[char];
                        const input = document.createElement('input');
                        input.className = 'user-input mono';
                        input.maxLength = 1;
                        input.dataset.cipher = cipher;
                        input.value = userProgress[cipher] || "";
                        
                        input.onfocus = () => activeInput = input;
                        input.oninput = (e) => handleLetterInput(cipher, e.target.value.toUpperCase());
                        input.onkeydown = handleKeyDown;

                        const cipherLabel = document.createElement('span');
                        cipherLabel.className = 'cipher-char mono';
                        cipherLabel.innerText = cipher;

                        cell.appendChild(input);
                        cell.appendChild(cipherLabel);
                    } else {
                        const punct = document.createElement('span');
                        punct.className = 'text-2xl font-bold pt-1 text-slate-500 mono';
                        punct.innerText = char;
                        cell.appendChild(punct);
                    }
                    wordDiv.appendChild(cell);
                });
                board.appendChild(wordDiv);
            });
        }

        function renderKeyboard() {
            const container = document.getElementById('keyboard');
            container.innerHTML = "";
            "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(key => {
                const btn = document.createElement('div');
                btn.className = 'keyboard-key mono';
                btn.innerText = key;
                btn.onclick = () => {
                    if (activeInput) {
                        handleLetterInput(activeInput.dataset.cipher, key);
                    }
                };
                container.appendChild(btn);
            });
        }

        function handleLetterInput(cipher, letter) {
            if (letter && !/[A-Z]/.test(letter)) return;

            userProgress[cipher] = letter;
            
            // Update all inputs with this cipher character
            const allWithCipher = document.querySelectorAll(`input[data-cipher="${cipher}"]`);
            allWithCipher.forEach(el => {
                el.value = letter;
                el.classList.remove('locked');
            });

            checkWin();
        }

        function handleKeyDown(e) {
            if (e.key === "Backspace" && !e.target.value) {
                // Focus previous input logic could go here
            }
        }

        function getHint() {
            const unsolved = [];
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
            
            alphabet.forEach(real => {
                const cipher = cipherMap[real];
                if (userProgress[cipher] !== real) {
                    unsolved.push({real, cipher});
                }
            });

            if (unsolved.length > 0) {
                const hint = unsolved[Math.floor(Math.random() * unsolved.length)];
                hintsUsed++;
                document.getElementById('hint-count').innerText = `Hints used: ${hintsUsed}`;
                
                handleLetterInput(hint.cipher, hint.real);
                
                // Visually mark as locked/hinted
                document.querySelectorAll(`input[data-cipher="${hint.cipher}"]`).forEach(el => {
                    el.classList.add('locked');
                });
            }
        }

        function clearBoard() {
            userProgress = {};
            document.querySelectorAll('.user-input').forEach(el => {
                el.value = "";
                el.classList.remove('locked');
            });
        }

        function checkWin() {
            let win = true;
            for (let char of currentQuote) {
                if (/[A-Z]/.test(char)) {
                    if (userProgress[cipherMap[char]] !== char) {
                        win = false;
                        break;
                    }
                }
            }

            if (win) {
                clearInterval(timerInterval);
                document.getElementById('final-stats').innerText = `Time: ${formatTime(seconds)} | Hints: ${hintsUsed}`;
                document.getElementById('modal').classList.remove('hidden');
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                seconds++;
                document.getElementById('timer').innerText = `Time: ${formatTime(seconds)}`;
            }, 1000);
        }

        function formatTime(s) {
            const mins = Math.floor(s / 60).toString().padStart(2, '0');
            const secs = (s % 60).toString().padStart(2, '0');
            return `${mins}:${secs}`;
        }

        function closeModal() {
            initGame();
        }

        // Initialize on load
        window.onload = initGame;
    </script>
</body>
</html>